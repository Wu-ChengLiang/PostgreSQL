# 🤖 智能预约功能测试指南

## 🎯 测试目标
模拟大模型输入，确保自然语言能够生成数据库预约记录，验证智能预约功能。

## 🚀 快速开始

### 1. 启动服务器
```bash
npm start
```
你会看到类似输出：
```
🚀 名医堂数据平台3.0 已启动
📍 服务器地址: http://127.0.0.1:3001
```

### 2. 运行测试脚本

#### 方法A: PowerShell测试（推荐）
```powershell
.\test_smart_api.ps1
```

#### 方法B: Node.js测试
```bash
node test_smart_appointment.js
```

## 🧠 模拟的大模型输入场景

### 场景1: 完整预约信息
**原始自然语言**: "我需要调理师-马老师为我服务，预计16:30到店"

**大模型解析结果**:
```json
{
  "therapist_name": "马老师",
  "appointment_time": "16:30", 
  "customer_name": "联系人_1750127546284",
  "store_name": "名医堂·颈肩腰腿特色调理（静安寺店）"
}
```

### 场景2: 部分信息（技师+时间）
**原始自然语言**: "预约今天下午3点钟的李老师"

**大模型解析结果**:
```json
{
  "therapist_name": "李老师",
  "appointment_time": "15:00",
  "customer_name": "测试用户A"
}
```

### 场景3: 只有技师信息
**原始自然语言**: "我要预约陈老师"

**大模型解析结果**:
```json
{
  "therapist_name": "陈老师"
}
```
*系统自动填充其他信息*

### 场景4: 只有时间信息
**原始自然语言**: "我要预约明天上午10点半"

**大模型解析结果**:
```json
{
  "appointment_time": "10:30",
  "appointment_date": "2025-06-18"
}
```
*系统自动匹配可用技师*

## 📊 预期结果

### ✅ 成功响应示例
```json
{
  "success": true,
  "data": {
    "appointment_id": 123,
    "user_name": "联系人_1750127546284",
    "appointment_date": "2025-06-17",
    "appointment_time": "16:30",
    "matched_therapist": {
      "id": 1,
      "name": "马老师"
    }
  },
  "message": "智能预约成功！技师: 马老师, 时间: 16:30, 客户: 联系人_1750127546284"
}
```

### 🛠️ 简化的必填项
- **之前**: 必须提供技师ID、用户名、预约日期、预约时间
- **现在**: 只需提供技师姓名OR预约时间（至少一个）
- **自动填充**: 客户姓名、预约日期、电话号码、技师匹配

## 🎯 前端验证

测试完成后，在前端监控台查看：

1. **服务器日志输出**:
   ```
   🤖 智能预约请求: {...}
   📋 使用技师: 马老师 (ID: 1)
   ✅ 预约创建成功: {...}
   ```

2. **前端页面**: 访问 `http://localhost:3001/frontend/admin.html`
   - 查看预约列表
   - 确认新创建的预约记录
   - 验证技师匹配是否正确

## 🔍 测试验证点

### ✅ 功能验证
- [ ] 自然语言解析正确
- [ ] 技师姓名智能匹配
- [ ] 预约时间格式化正确
- [ ] 数据库记录创建成功
- [ ] 前端显示预约信息

### 📝 API端点
- `POST /api/v1/client/appointments/smart` - 智能预约创建
- `GET /api/v1/client/stores` - 验证API可用性
- `GET /api/v1/admin/appointments` - 查看预约列表

## ⚙️ 故障排除

### 问题1: 服务器未启动
```
❌ 错误: 无法连接到服务器
```
**解决**: 运行 `npm start` 启动服务器

### 问题2: 技师不存在
```
❌ 错误: 未找到可用的技师
```
**解决**: 检查数据库中是否有技师数据

### 问题3: 路由不存在
```
❌ 错误: 请求的资源不存在
```
**解决**: 确认API路径正确，服务器版本最新

## 🎉 成功标准

✅ **测试通过标准**:
1. 至少3个测试用例成功创建预约
2. 前端能正确显示新创建的预约记录
3. 服务器日志显示智能匹配过程
4. 数据库中保存了完整的预约信息

## 📞 技术支持

如有问题，请检查：
1. Node.js和npm版本是否兼容
2. 数据库连接是否正常
3. 端口3001是否被占用
4. 防火墙设置是否阻止连接 